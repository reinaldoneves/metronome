<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Metrônomo Progressivo</title>


<!-- Structured Data (JSON-LD) - WebApplication -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Metrônomo Progressivo",
  "description": "Metrônomo online com aceleração progressiva, tap tempo, unidades de tempo simples e compostas, e atalhos de teclado.",
  "applicationCategory": "MusicUtility",
  "operatingSystem": "Any",
  "browserRequirements": "Requires audio output.",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "BRL"
  },
  "author": {
    "@type": "Person",
    "name": "Prof. Reinaldo Neves",
    "url": "https://reinaldoneves.com.br"
  }
}
</script>

<style>
:root{
  --accent:#EE9B19;
  --bg:#000;
  --text:#fff;
  --muted:#b5b5b5;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Inter,system-ui,sans-serif;
}
.app{padding:16px;max-width:520px;margin:auto}
.header{text-align:center;margin-bottom:24px}
.bpm .value{font-size:3rem;color:var(--accent);font-weight:600}
.start-wrap{width:260px;height:260px;margin:24px auto;position:relative}
svg{transform:rotate(-90deg)}
.start-btn{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  font-size:2.2rem;cursor:pointer;
  border-radius:50%;
  transition:box-shadow .08s ease;
}
.start-btn.pulse-strong{
  box-shadow:
    0 0 70px rgba(238, 25, 25, 0.95),
    0 0 120px rgba(238,155,25,.55);
}
.start-btn.pulse-weak{
  box-shadow:
    0 0 26px rgba(238,155,25,.55),
    0 0 48px rgba(238,155,25,.25);
}
.time-signature{
  text-align:center;
  margin-top:16px;
  margin-bottom:8px;
  font-size:1.4rem;
  font-weight:600;
  color:var(--accent);
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}
.time-signature .label{
  font-size:0.9rem;
  color:var(--muted);
  font-weight:normal;
}
#timeSignatureDisplay{
  background:rgba(238,155,25,.1);
  padding:6px 16px;
  border-radius:30px;
  border:1px solid rgba(238,155,25,.3);
  display:inline-block;
}
.section{
  background:linear-gradient(180deg,#1a1a1a,#0f0f0f);
  border-radius:14px;padding:16px;margin-bottom:16px;
}
.section-title{
  font-size:.7rem;letter-spacing:.14em;
  text-transform:uppercase;color:var(--accent);margin-bottom:14px
}
/* Aumentando fonte dos labels dos sliders na seção Tempo */
.section .slider-row label{
  font-size:0.9rem; /* antes 0.75rem */
  margin-bottom:8px; /* ajuste fino */
}
.section .slider-row .slider-value{
  font-size:0.85rem; /* antes 0.75rem */
  padding:4px 10px; /* um pouco mais espaçoso */
}
label{
  font-size:.75rem;
  color:var(--muted);
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:6px;
}
.label-text{ color:var(--muted); }
.slider-value{
  background:rgba(238,155,25,.15);
  padding:2px 8px;
  border-radius:12px;
  font-size:.75rem;
  color:var(--accent);
  font-weight:600;
  border:1px solid rgba(238,155,25,.3);
}
input[type=range]{
  -webkit-appearance:none;
  width:100%;
  height:6px;
  border-radius:6px;
  background:linear-gradient(90deg,#3a2a10,#a96b18,#3a2a10);
  outline:none;
  margin-bottom:14px;
}
input[type=range]::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:22px;height:22px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%,#ffd27d,#b87418);
  border:1px solid #6b3e0f;
  box-shadow:0 2px 6px rgba(0,0,0,.6);
  cursor:pointer;
}
input[type=range]::-moz-range-thumb{
  width:22px;height:22px;
  border-radius:50%;
  background:#c9821c;
  border:1px solid #6b3e0f;
}
input[type=text]{
  width:100%;
  background:#0b0b0b;
  border:1px solid rgba(238,155,25,.35);
  border-radius:10px;
  padding:12px;
  color:#fff;
}
.units,.presets{display:flex;gap:10px;flex-wrap:wrap}
.unit,.preset, .progression-toggle{
  flex:1 1 80px;
  border:1px solid rgba(238,155,25,.35);
  border-radius:10px;
  text-align:center;
  padding:10px;
  cursor:pointer;
  font-size:.85rem;
  transition:all 0.1s ease;
}
.unit.active,.preset:hover, .progression-toggle.active{
  background:rgba(238,155,25,.2);
  border-color:var(--accent);
}
.range input{width:100%}
.version{text-align:center;font-size:.65rem;color:#666;margin-top:8px}
.version h3{display:inline;font-size:.65rem;color:var(--accent);margin:0}
.tap-center{
  display:flex;
  justify-content:center;
  margin-bottom:24px;
  margin-top:8px;
}
.tap-btn{
  width:64px;
  height:64px;
  border-radius:50%;
  border:2px solid rgba(238,155,25,.5);
  background:rgba(238,155,25,.1);
  color:var(--accent);
  font-size:.9rem;
  font-weight:bold;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:all 0.15s ease;
  flex-shrink:0;
  padding:0;
  line-height:1;
  text-transform:uppercase;
  letter-spacing:1px;
  box-shadow:0 0 15px rgba(238,155,25,.2);
}
.tap-btn:hover{
  background:rgba(238,155,25,.2);
  border-color:var(--accent);
  transform:scale(1.08);
  box-shadow:0 0 25px rgba(238,155,25,.4);
}
.tap-btn:active{
  background:rgba(238,155,25,.4);
  transform:scale(0.95);
  box-shadow:0 0 30px rgba(238,155,25,.6);
}
.shortcuts{
  display:flex;
  justify-content:center;
  gap:20px;
  margin-top:12px;
  margin-bottom:4px;
  font-size:.7rem;
  color:var(--muted);
  flex-wrap:wrap;
}
.shortcut-key{
  display:inline-block;
  background:rgba(238,155,25,.15);
  border:1px solid rgba(238,155,25,.3);
  border-radius:6px;
  padding:2px 8px;
  color:var(--accent);
  font-weight:600;
  margin-left:4px;
}
.mobile-bpm-buttons{
  display:none;
  justify-content:center;
  gap:20px;
  margin-top:10px;
  margin-bottom:5px;
}
.mobile-bpm-btn{
  width:50px;
  height:50px;
  border-radius:50%;
  border:2px solid var(--accent);
  background:rgba(238,155,25,.1);
  color:var(--accent);
  font-size:1.3rem;
  font-weight:bold;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:all 0.1s ease;
}
.mobile-bpm-btn:active{
  background:rgba(238,155,25,.4);
  transform:scale(0.9);
}
@media (max-width:600px){
  .mobile-bpm-buttons{
    display:flex;
  }
}
</style>
</head>

<body>
<div class="app">

<div class="header">
  <h1>Metrônomo Progressivo</h1>
  <div class="bpm">
    <div class="value" id="bpmDisplay">80</div>
    <div>BPM</div>
  </div>
</div>

<div class="start-wrap">
  <svg width="260" height="260">
    <circle cx="130" cy="130" r="115" stroke="#1c1c1c" stroke-width="10" fill="none"/>
    <circle id="ring" cx="130" cy="130" r="115"
      stroke="var(--accent)" stroke-width="10" fill="none"
      stroke-dasharray="722" stroke-dashoffset="722"/>
  </svg>
  <div class="start-btn" id="toggle">Start</div>
</div>

<div class="time-signature">
  <span class="label">Compasso</span>
  <span id="timeSignatureDisplay">4/4 ♩</span>
</div>

<div class="section">
  <div class="section-title">Presets de Treino</div>
  <div class="presets">
    <div class="preset" data-preset="warmup">Aquecimento</div>
    <div class="preset" data-preset="speedup">Speed Up</div>
    <div class="preset" data-preset="control">Controle</div>
    <div class="preset" data-preset="steady">Estável</div>
  </div>
</div>

<div class="section">
  <div class="section-title">Tempo</div>

  <div class="tap-center">
    <div id="tapBtn" class="tap-btn">Tap</div>
  </div>

  <div class="mobile-bpm-buttons">
    <div class="mobile-bpm-btn" id="bpmDown">−5</div>
    <div class="mobile-bpm-btn" id="bpmUp">+5</div>
  </div>

  <div class="slider-row">
    <label>
      <span class="label-text">Inicial</span>
      <span class="slider-value" id="bpmStartVal">80</span>
    </label>
    <input id="bpmStart" type="range" min="30" max="300" step="1" value="80">
  </div>

  <div class="slider-row">
    <label>
      <span class="label-text">Máximo / Mínimo</span>
      <span class="slider-value" id="bpmMaxVal">160</span>
    </label>
    <input id="bpmMax" type="range" min="30" max="300" step="1" value="160">
  </div>

  <div class="slider-row">
    <label>
      <span class="label-text">Variação</span>
      <span class="slider-value" id="bpmStepVal">10</span>
    </label>
    <input id="bpmStep" type="range" min="5" max="50" step="1" value="10">
  </div>

  <div class="slider-row">
    <label>
      <span class="label-text">A cada quantos compassos</span>
      <span class="slider-value" id="bpmEveryBarsVal">4</span>
    </label>
    <input id="bpmEveryBars" type="range" min="1" max="64" step="1" value="4">
  </div>

  <div style="margin-top:16px;">
    <div class="section-title">Progressão Automática</div>
    <div id="progressionToggle" class="progression-toggle active">Progressão: ON</div>
  </div>
</div>

<div class="section">
  <div class="section-title">Compasso</div>
  <label>
    <span class="label-text">Tempos por compasso</span>
    <span class="slider-value" id="beatsPerBarVal">4</span>
  </label>
  <input id="beatsPerBar" type="range" min="1" max="24" step="1" value="4">
</div>

<div class="section">
  <div class="section-title">Unidade de Tempo</div>
  <div class="units">
    <div class="unit active" data-factor="1">♩</div>
    <div class="unit" data-factor="0.5">♪</div>
    <div class="unit" data-factor="0.25">♬</div>
    <div class="unit" data-factor="0.125">♬♬</div>
    <div class="unit" data-factor="1.5">♩.</div>
    <div class="unit" data-factor="0.75">♪.</div>
    <div class="unit" data-factor="0.375">♬.</div>
  </div>
</div>

<div class="section">
  <div class="section-title">Mixer</div>
  
  <div class="slider-row">
    <label>
      <span class="label-text">Volume Geral</span>
      <span class="slider-value" id="masterGainVal">6.0</span>
    </label>
    <div class="range"><input id="masterGain" type="range" min="0" max="12" step="0.1" value="6.0"></div>
  </div>

  <div class="slider-row">
    <label>
      <span class="label-text">Tempo Forte</span>
      <span class="slider-value" id="accentGainVal">6.0</span>
    </label>
    <div class="range"><input id="accentGain" type="range" min="0" max="12" step="0.1" value="6.0"></div>
  </div>

  <div class="slider-row">
    <label>
      <span class="label-text">Tempo Fraco</span>
      <span class="slider-value" id="normalGainVal">6.0</span>
    </label>
    <div class="range"><input id="normalGain" type="range" min="0" max="12" step="0.1" value="6.0"></div>
  </div>
</div>

<div class="shortcuts">
  <span>␣ <span class="shortcut-key">espaço</span> play/stop</span>
  <span>↑ <span class="shortcut-key">+5 BPM</span></span>
  <span>↓ <span class="shortcut-key">-5 BPM</span></span>
</div>

<div class="version">v2.19.0 · <h3>Profº Reinaldo Neves</h3> · fontes maiores nos sliders de tempo</div>
</div>

<script>
const bpmDisplay = document.getElementById('bpmDisplay');
const ring = document.getElementById('ring');
const toggle = document.getElementById('toggle');

const bpmStart = document.getElementById('bpmStart');
const bpmMax = document.getElementById('bpmMax');
const bpmStep = document.getElementById('bpmStep');
const bpmEveryBars = document.getElementById('bpmEveryBars');
const beatsPerBar = document.getElementById('beatsPerBar');

const masterGainSlider = document.getElementById('masterGain');
const accentGainSlider = document.getElementById('accentGain');
const normalGainSlider = document.getElementById('normalGain');

const bpmStartVal = document.getElementById('bpmStartVal');
const bpmMaxVal = document.getElementById('bpmMaxVal');
const bpmStepVal = document.getElementById('bpmStepVal');
const bpmEveryBarsVal = document.getElementById('bpmEveryBarsVal');
const beatsPerBarVal = document.getElementById('beatsPerBarVal');
const masterGainVal = document.getElementById('masterGainVal');
const accentGainVal = document.getElementById('accentGainVal');
const normalGainVal = document.getElementById('normalGainVal');

const progressionToggle = document.getElementById('progressionToggle');
const timeSignatureDisplay = document.getElementById('timeSignatureDisplay');
const tapBtn = document.getElementById('tapBtn');

const bpmUp = document.getElementById('bpmUp');
const bpmDown = document.getElementById('bpmDown');

let ctx = null;
let masterGainNode = null;
let limiter = null;
let strongBuf = null;
let weakBuf = null;

let isPlaying = false;
let bpm = 80;
let beat = 0;
let barCount = 0;
let timer = null;
let unitFactor = 1;
let progressionEnabled = true;

const BPM_MIN = 30;
const BPM_MAX = 300;

let tapTimes = [];
const MAX_TAPS = 8;

function updateBpmFromTap() {
  if (tapTimes.length < 2) return;
  let sum = 0;
  for (let i = 1; i < tapTimes.length; i++) {
    sum += tapTimes[i] - tapTimes[i-1];
  }
  const avgInterval = sum / (tapTimes.length - 1);
  let newBpm = Math.round(60000 / avgInterval);
  newBpm = Math.min(BPM_MAX, Math.max(BPM_MIN, newBpm));
  bpmStart.value = newBpm;
  bpmStartVal.textContent = newBpm;
  if (!isPlaying) {
    bpmDisplay.textContent = newBpm;
  }
  restartIfPlaying();
}

tapBtn.onclick = () => {
  const now = Date.now();
  tapTimes.push(now);
  if (tapTimes.length > MAX_TAPS) {
    tapTimes = tapTimes.slice(-MAX_TAPS);
  }
  tapBtn.style.background = 'rgba(238,155,25,.4)';
  tapBtn.style.borderColor = 'var(--accent)';
  setTimeout(() => {
    tapBtn.style.background = '';
    tapBtn.style.borderColor = '';
  }, 120);
  updateBpmFromTap();
};

function restartIfPlaying() {
  if (isPlaying) {
    clearTimeout(timer);
    beat = 0;
    barCount = 0;
    bpm = clampBpm(+bpmStart.value);
    bpmDisplay.textContent = Math.round(bpm);
    ring.style.strokeDashoffset = '722';
    loop();
  }
}

function updateAllSliderValues() {
  bpmStartVal.textContent = bpmStart.value;
  bpmMaxVal.textContent = bpmMax.value;
  bpmStepVal.textContent = bpmStep.value;
  bpmEveryBarsVal.textContent = bpmEveryBars.value;
  beatsPerBarVal.textContent = beatsPerBar.value;
  masterGainVal.textContent = parseFloat(masterGainSlider.value).toFixed(1);
  accentGainVal.textContent = parseFloat(accentGainSlider.value).toFixed(1);
  normalGainVal.textContent = parseFloat(normalGainSlider.value).toFixed(1);
}

function updateBpmDisplay() {
  if (!isPlaying) {
    bpmDisplay.textContent = bpmStart.value;
  }
}

function updateTimeSignature() {
  const beats = beatsPerBar.value;
  const activeUnit = document.querySelector('.unit.active');
  const unitSymbol = activeUnit ? activeUnit.textContent.trim() : '♩';
  let denominator;
  if (Math.abs(unitFactor - 1.5) < 0.0001) {
    denominator = 8;
  } else if (Math.abs(unitFactor - 0.75) < 0.0001) {
    denominator = 16;
  } else if (Math.abs(unitFactor - 0.375) < 0.0001) {
    denominator = 32;
  } else {
    denominator = Math.round(4 / unitFactor);
  }
  timeSignatureDisplay.textContent = `${beats}/${denominator} ${unitSymbol}`;
}

function initAudio() {
  if (ctx) return;
  ctx = new (window.AudioContext || window.webkitAudioContext)();
  masterGainNode = ctx.createGain();
  limiter = ctx.createDynamicsCompressor();
  limiter.threshold.value = -3;
  limiter.ratio.value = 12;
  masterGainNode.connect(limiter);
  limiter.connect(ctx.destination);
}

function sliderToGain(value) {
  return value / 6.0;
}

function playFallback(accent) {
  if (!ctx) return;
  const osc = ctx.createOscillator();
  const g = ctx.createGain();
  osc.type = "sine";
  osc.frequency.value = accent ? 1200 : 900;
  const masterGainLinear = sliderToGain(+masterGainSlider.value);
  const localGainLinear = sliderToGain(accent ? +accentGainSlider.value : +normalGainSlider.value);
  const totalGain = masterGainLinear * localGainLinear;
  g.gain.setValueAtTime(0.0001, ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(totalGain, ctx.currentTime + 0.002);
  g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.04);
  osc.connect(g);
  g.connect(masterGainNode);
  osc.start();
  osc.stop(ctx.currentTime + 0.05);
}

function playSample(buf, localSliderValue) {
  if (!ctx || !buf) return playFallback(false);
  const s = ctx.createBufferSource();
  const g = ctx.createGain();
  const masterGainLinear = sliderToGain(+masterGainSlider.value);
  const localGainLinear = sliderToGain(localSliderValue);
  g.gain.value = masterGainLinear * localGainLinear;
  s.buffer = buf;
  s.connect(g);
  g.connect(masterGainNode);
  s.start();
}

function click(accent) {
  toggle.classList.remove('pulse-strong', 'pulse-weak');
  const cls = accent ? 'pulse-strong' : 'pulse-weak';
  toggle.classList.add(cls);
  setTimeout(() => toggle.classList.remove(cls), 70);
  if (accent && strongBuf) playSample(strongBuf, +accentGainSlider.value);
  else if (!accent && weakBuf) playSample(weakBuf, +normalGainSlider.value);
  else playFallback(accent);
}

function tick() {
  const beats = +beatsPerBar.value || 4;
  const isAccent = beat % beats === 0;
  click(isAccent);
  const progress = (beat % beats + 1) / beats;
  ring.style.strokeDashoffset = 722 - (722 * progress);
  beat++;
  if (progressionEnabled && isAccent && beat > 0) {
    barCount++;
    const everyBars = +bpmEveryBars.value || 1;
    if (barCount % everyBars === 0) {
      const target = clampBpm(+bpmMax.value);
      const step = Math.abs(+bpmStep.value);
      if (bpm < target) bpm = clampBpm(bpm + step);
      else if (bpm > target) bpm = clampBpm(bpm - step);
      bpmDisplay.textContent = Math.round(bpm);
    }
  }
}

function loop() {
  if (!isPlaying) return;
  tick();
  const intervalMs = (60 / bpm) * unitFactor * 1000;
  timer = setTimeout(loop, intervalMs);
}

function clampBpm(v) {
  return Math.min(BPM_MAX, Math.max(BPM_MIN, v));
}

async function loadSample(url) {
  try {
    const response = await fetch(url);
    const buffer = await response.arrayBuffer();
    return await ctx.decodeAudioData(buffer);
  } catch (e) {
    console.warn(`Falha ao carregar ${url}`, e);
    return null;
  }
}

async function loadAllSamples() {
  if (!ctx) initAudio();
  if (strongBuf && weakBuf) return;
  const strongUrl = 'https://reinaldoneves.com.br/wp-content/uploads/2026/02/block_forte-1.mp3';
  const weakUrl = 'https://reinaldoneves.com.br/wp-content/uploads/2026/02/block_fraco-1.mp3';
  [strongBuf, weakBuf] = await Promise.all([
    loadSample(strongUrl),
    loadSample(weakUrl)
  ]);
}

toggle.onclick = async () => {
  if (!ctx) initAudio();
  await ctx.resume();
  loadAllSamples();
  if (!isPlaying) {
    bpm = clampBpm(+bpmStart.value);
    bpmDisplay.textContent = Math.round(bpm);
    beat = 0;
    barCount = 0;
    ring.style.strokeDashoffset = '722';
    isPlaying = true;
    toggle.textContent = 'Stop';
    loop();
  } else {
    isPlaying = false;
    clearTimeout(timer);
    ring.style.strokeDashoffset = '722';
    toggle.textContent = 'Start';
  }
};

const presets = {
  warmup:   { bpmStart: 55, bpmMax: 90,  bpmStep: 5, bpmEveryBars: 12, beats: 2, unit: 1 },
  speedup:  { bpmStart: 80, bpmMax: 160, bpmStep: 10, bpmEveryBars: 16, beats: 4, unit: 1 },
  control:  { bpmStart: 140, bpmMax: 90, bpmStep: 5, bpmEveryBars: 16, beats: 2, unit: 1 },
  steady:   { bpmStart: 100, bpmMax: 100, bpmStep: 0, bpmEveryBars: 12, beats: 2, unit: 1 }
};

document.querySelectorAll('.preset').forEach(p => {
  p.onclick = () => {
    const s = presets[p.dataset.preset];
    bpmStart.value = s.bpmStart;
    bpmMax.value = s.bpmMax;
    bpmStep.value = s.bpmStep;
    bpmEveryBars.value = s.bpmEveryBars;
    beatsPerBar.value = s.beats;
    updateAllSliderValues();
    document.querySelectorAll('.unit').forEach(u => {
      const factor = +u.dataset.factor;
      u.classList.toggle('active', factor === s.unit);
      if (factor === s.unit) {
        unitFactor = s.unit;
        updateTimeSignature();
      }
    });
    if (p.dataset.preset === 'steady') {
      progressionEnabled = false;
      progressionToggle.classList.remove('active');
      progressionToggle.textContent = 'Progressão: OFF';
    } else {
      progressionEnabled = true;
      progressionToggle.classList.add('active');
      progressionToggle.textContent = 'Progressão: ON';
    }
    restartIfPlaying();
    if (!isPlaying) {
      bpmDisplay.textContent = s.bpmStart;
      ring.style.strokeDashoffset = '722';
    }
  };
});

document.querySelectorAll('.unit').forEach(u => {
  u.onclick = () => {
    document.querySelectorAll('.unit').forEach(x => x.classList.remove('active'));
    u.classList.add('active');
    unitFactor = parseFloat(u.dataset.factor);
    updateTimeSignature();
    restartIfPlaying();
  };
});

progressionToggle.onclick = () => {
  progressionEnabled = !progressionEnabled;
  progressionToggle.classList.toggle('active', progressionEnabled);
  progressionToggle.textContent = progressionEnabled ? 'Progressão: ON' : 'Progressão: OFF';
};

function adjustBpm(delta) {
  let newVal = parseInt(bpmStart.value, 10) + delta;
  newVal = Math.min(BPM_MAX, Math.max(BPM_MIN, newVal));
  bpmStart.value = newVal;
  bpmStartVal.textContent = newVal;
  if (!isPlaying) bpmDisplay.textContent = newVal;
  restartIfPlaying();
  tapTimes = [];
}

bpmUp.onclick = () => adjustBpm(5);
bpmDown.onclick = () => adjustBpm(-5);

bpmStart.addEventListener('input', () => {
  updateAllSliderValues();
  updateBpmDisplay();
  restartIfPlaying();
  tapTimes = [];
});

bpmMax.addEventListener('input', () => {
  updateAllSliderValues();
  restartIfPlaying();
});

bpmStep.addEventListener('input', () => {
  updateAllSliderValues();
  restartIfPlaying();
});

bpmEveryBars.addEventListener('input', () => {
  updateAllSliderValues();
  restartIfPlaying();
});

beatsPerBar.addEventListener('input', () => {
  updateAllSliderValues();
  updateTimeSignature();
  restartIfPlaying();
});

masterGainSlider.addEventListener('input', updateAllSliderValues);
accentGainSlider.addEventListener('input', updateAllSliderValues);
normalGainSlider.addEventListener('input', updateAllSliderValues);

function handleKeyDown(e) {
  if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
    return;
  }
  switch (e.code) {
    case 'Space':
      e.preventDefault();
      toggle.onclick();
      break;
    case 'ArrowUp':
      e.preventDefault();
      adjustBpm(5);
      break;
    case 'ArrowDown':
      e.preventDefault();
      adjustBpm(-5);
      break;
  }
}

window.addEventListener('keydown', handleKeyDown);

updateAllSliderValues();
updateBpmDisplay();
updateTimeSignature();
ring.style.strokeDashoffset = '722';

window.addEventListener('load', () => {
  if (!ctx) initAudio();
  loadAllSamples();
});
</script>

</body>
</html>
